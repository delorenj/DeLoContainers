services:
  # Redis service removed - using external Redis container on network 'proxy'
  # Connection details:
  # - Host: redis (container name on proxy network)
  # - Port: 6379 (standard Redis port)
  # - Password: ${REDIS_PASSWORD} (from .env)
  # - Network: proxy

  qdrant:
    container_name: qdrant
    image: qdrant/qdrant
    ports:
      - "6333:6333" # REST API
      - "6334:6334" # GRPC API
    expose:
      - 6333
      - 6334
    volumes:
      - qdrant_data:/qdrant/storage
    restart: unless-stopped
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.qdrant.rule=Host(`qdrant.delo.sh`)"
      - "traefik.http.routers.qdrant.entrypoints=websecure"
      - "traefik.http.routers.qdrant.tls.certresolver=letsencrypt"
      - "traefik.http.services.qdrant.loadbalancer.server.port=6333"
      - "traefik.docker.network=proxy"
    environment:
      - QDRANT__SERVICE__API_KEY=${QDRANT_API_KEY}

  neo4j:
    image: neo4j:latest
    volumes:
      - ./neo4j/logs:/logs
      - ./neo4j/config:/config
      - ./neo4j/data:/data
      - ./neo4j/plugin:/plugins
    environment:
      - NEO4J_AUTH_FILE=/run/secrets/neo4j_auth_file
    ports:
      - "7474:7474"
      - "7687:7687"
    restart: unless-stopped
    secrets:
      - neo4j_auth_file

secrets:
  neo4j_auth_file:
    file: ./neo4j/.credentials

volumes:
  qdrant_data:

networks:
  proxy:
    external: true
